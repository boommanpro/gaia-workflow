{
  "nodes": [
    {
      "id": "start_0",
      "type": "start",
      "meta": {
        "position": {
          "x": 180,
          "y": 7.25
        }
      },
      "data": {
        "title": "开始节点",
        "outputs": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "default": "Hello Flow."
            },
            "enable": {
              "type": "boolean",
              "default": true
            },
            "array_obj": {
              "type": "array",
              "items": {
                "type": "integer"
              },
              "default": "[1,2,3]"
            }
          },
          "required": []
        }
      }
    },
    {
      "id": "end_0",
      "type": "end",
      "meta": {
        "position": {
          "x": 2020,
          "y": 7.25
        }
      },
      "data": {
        "title": "结束节点",
        "inputsValues": {
          "format": {
            "type": "ref",
            "content": [
              "string_format_j_zgL",
              "formatStringResult"
            ]
          }
        },
        "inputs": {
          "type": "object",
          "properties": {
            "format": {
              "type": "string"
            }
          }
        }
      }
    },
    {
      "id": "code_azggU",
      "type": "code",
      "meta": {
        "position": {
          "x": 1100,
          "y": 0
        }
      },
      "data": {
        "title": "Code_1",
        "inputsValues": {
          "users": {
            "type": "ref",
            "content": [
              "variable_oIIFA",
              "users"
            ],
            "extra": {
              "index": 0
            }
          }
        },
        "script": {
          "language": "java",
          "content": "package cn.boommanpro.gaiaworkflow;\n\nimport cn.boommanpro.gaia.workflow.code.CodeExecute;\n\nimport java.util.*;\nimport com.fasterxml.jackson.databind.ObjectMapper;\n\npublic class HelloCodeExecute implements CodeExecute {\n    private static final ObjectMapper objectMapper = new ObjectMapper();\n\n    @Override\n    public Map<String, Object> execute(Map<String, Object> inputs) {\n        HashMap<String, Object> result = new HashMap<>();\n\n        try {\n            // 获取user数组\n            Object userObj = inputs.get(\"users\");\n            if (userObj instanceof List) {\n                List<String> userStrings = (List<String>) userObj;\n                List<Object> cleanedUsers = new ArrayList<>();\n\n                for (String userStr : userStrings) {\n                    try {\n                        // 清洗数据：去除```json和```标记\n                        String cleanedStr = cleanJsonString(userStr);\n\n                        // 解析JSON字符串为对象\n                        Object userObject = objectMapper.readValue(cleanedStr, Object.class);\n                        cleanedUsers.add(userObject);\n                    } catch (Exception e) {\n                        // 如果解析失败，可以记录错误或跳过\n                        System.err.println(\"Failed to parse user string: \" + userStr);\n                        e.printStackTrace();\n                    }\n                }\n\n                result.put(\"users\", cleanedUsers);\n            }\n        } catch (Exception e) {\n            System.err.println(\"Error processing user data: \" + e.getMessage());\n            e.printStackTrace();\n        }\n\n        return result;\n    }\n\n    /**\n     * 清洗JSON字符串，去除```json和```标记\n     */\n    private String cleanJsonString(String jsonString) {\n        if (jsonString == null) {\n            return \"\";\n        }\n\n        // 去除开头的```json\n        if (jsonString.startsWith(\"```json\")) {\n            jsonString = jsonString.substring(7).trim();\n        }\n\n        // 去除结尾的```\n        if (jsonString.endsWith(\"```\")) {\n            jsonString = jsonString.substring(0, jsonString.length() - 3).trim();\n        }\n\n        return jsonString;\n    }\n}\n"
        },
        "outputs": {
          "type": "object",
          "properties": {
            "users": {
              "type": "object"
            }
          },
          "required": []
        },
        "inputs": {
          "type": "object",
          "properties": {
            "users": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    {
      "id": "string_format_j_zgL",
      "type": "string-format",
      "meta": {
        "position": {
          "x": 1560,
          "y": 0
        }
      },
      "data": {
        "title": "StringFormat_2",
        "inputsValues": {
          "users": {
            "type": "ref",
            "content": [
              "code_azggU",
              "users"
            ],
            "extra": {
              "index": 0
            }
          }
        },
        "script": {
          "language": "spel-vue",
          "content": "城市:{{users[0].city}}\\n\n姓名:{{users[0].name}}\\n\n工作:{{users[0].job}}\\n\n年龄:{{users[0].age}}"
        },
        "outputs": {
          "type": "object",
          "properties": {
            "formatStringResult": {
              "type": "string"
            }
          }
        },
        "inputs": {
          "type": "object",
          "properties": {
            "users": {
              "type": "object",
              "required": [],
              "properties": {}
            }
          }
        }
      }
    },
    {
      "id": "variable_oIIFA",
      "type": "variable",
      "meta": {
        "position": {
          "x": 640,
          "y": 17.5
        }
      },
      "data": {
        "title": "Variable_1",
        "assign": [
          {
            "operator": "declare",
            "left": "users",
            "right": {
              "type": "constant",
              "content": "[\"{\\\"city\\\": \\\"Beijing\\\", \\\"name\\\": \\\"Zhang San\\\", \\\"job\\\": \\\"Engineer\\\", \\\"age\\\": 28}\",\"{\\\"city\\\": \\\"Beijing\\\", \\\"name\\\": \\\"Zhang San\\\", \\\"job\\\": \\\"Engineer\\\", \\\"age\\\": 28}\",\"{\\\"city\\\": \\\"北京\\\", \\\"name\\\": \\\"张三\\\", \\\"job\\\": \\\"工程师\\\", \\\"age\\\": 28}\"]",
              "schema": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        ],
        "outputs": {
          "type": "object",
          "required": [],
          "properties": {
            "users": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    }
  ],
  "edges": [
    {
      "sourceNodeID": "start_0",
      "targetNodeID": "variable_oIIFA"
    },
    {
      "sourceNodeID": "string_format_j_zgL",
      "targetNodeID": "end_0"
    },
    {
      "sourceNodeID": "variable_oIIFA",
      "targetNodeID": "code_azggU"
    },
    {
      "sourceNodeID": "code_azggU",
      "targetNodeID": "string_format_j_zgL"
    }
  ]
}
